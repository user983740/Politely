# test-transform Execution Log

## Metadata
- **Execution time**: 2026-02-23 18:15:00
- **Git Commit**: 2b653cb (branch: main)
- **Scenarios run**: 1, 2, 3, 4

## Code Context

### Recent Backend Change History

```
2b653cb refactor(backend): remove conditional Gemini/OpenAI fallback for model selection
7c4c32a feat(backend): migrate pipeline to Gemini models with async booster and yellow scanner
af398b7 refactor(backend): optimize labeling and final prompts for clarity and token savings
6c69a11 refactor(backend): merge ContextGating into SituationAnalysis
e075459 chore(backend): update default openai model to gpt-4o and add test log
31e584f fix(backend): replace passlib with bcrypt to fix CI test failures
edc5fbb test(backend): add comprehensive test suite (68 tests across 8 modules)
b0ea279 style(backend): fix E501 line-too-long lint errors across 9 files
fedf917 refactor(backend): rename exceptions to *Error convention, remove unused imports
9410f28 refactor: migrate backend from Spring Boot (Java) to FastAPI (Python)
```

### Pipeline Structure Summary

Current pipeline configuration (based on this test's stats event and config.py):

- **Segmentation**: MeaningSegmenter (max-segment-length: 250, discourse-marker-min-length: 150, enumeration-min-length: 120) + LlmSegmentRefiner (threshold: 250 chars)
- **Labeling**: StructureLabelService (model: gpt-4o-mini fallback, temp: 0.2) → 3-tier 14 labels
- **RED enforcement**: RedLabelEnforcer (definitive instant RED + ambiguous GREEN→YELLOW)
- **Gating**: IdentityBooster(미실행 — 전 시나리오), SituationAnalysis(always-on), ContextGating(merged into SA)
- **Template**: T08_FEEDBACK(시나리오1), T05_APOLOGY(시나리오2,4), T11_REFUND_REJECTION(시나리오3)
- **Final transform**: gpt-4o (temp: 0.85, maxTokens: 4000)
- **Validation**: OutputValidator 12 rules, retry 발생: 시나리오4에서 1회 (SECTION_S2_MISSING WARNING)

### Key Settings (config.py)

```python
openai_model = "gpt-4o"
openai_temperature = 0.85
openai_max_tokens = 2000        # FREE tier
openai_max_tokens_paid = 4000   # PAID tier
gemini_api_key = ""             # 미설정 → OpenAI fallback
gemini_final_model = "gemini-2.5-flash"
gemini_label_model = "gemini-2.5-flash-lite"
segmenter_max_segment_length = 250
segmenter_discourse_marker_min_length = 150
segmenter_enumeration_min_length = 120
```

### Recent Major Changes

- `2b653cb`: Gemini/OpenAI 조건부 fallback 제거 → 모델 선택 로직 단순화
- `7c4c32a`: 파이프라인 Gemini 모델 마이그레이션 + async booster + yellow scanner 추가
- `af398b7`: 라벨링/최종 프롬프트 최적화 (명확성 + 토큰 절약)

## Per-Scenario Results

---

### Scenario 1: 학부모/피드백

**라벨링 결과**

| ID | Position | Tier | Label | 텍스트 (앞 30자) |
| --- | --- | --- | --- | --- |
| T1 | 0-8 | GREEN | COURTESY | 안녕하쇼 담임임 |
| T2 | 10-27 | GREEN | CORE_FACT | 님 애가 시험을 망해서 놀라셨죠 |
| T3 | 29-53 | YELLOW | SELF_JUSTIFICATION | 근데 내 탓하려고 시동걸거 같아서 말해두는데 |
| T4 | 54-88 | YELLOW | ACCOUNTABILITY | 난 숙제도 제대로 내주고 진도 따라서 스터디 플랜도 잘 짜줬다 |
| T5 | 90-104 | YELLOW | NEGATIVE_FEEDBACK | 근데 님 애가 안 쳐한거임 |
| T6 | 106-126 | RED | PERSONAL_ATTACK | 학원 바꿀꺼면 머 ㅃㅃ인데 못바꾸잔아 |
| T7 | 127-160 | YELLOW | NEGATIVE_FEEDBACK | 걍 다음에 잘 보고 싶으면 님도 애를 좀 잡아봐 숙제를 하게 |

**Situation Analysis**

- **Intent**: 학생의 성적 문제에 대한 책임을 분명히 하고, 학부모에게 학생의 학습을 도와줄 것을 요청하려는 목적

| # | Fact (content) | Source (source) |
| --- | --- | --- |
| 1 | 담임 교사가 학부모에게 인사하고 있다 | 안녕하쇼 담임임. |
| 2 | 학생이 시험에서 좋지 않은 성적을 받았다 | 님 애가 시험을 망해서 놀라셨죠. |
| 3 | 담임 교사는 숙제를 제대로 내주고 스터디 플랜을 잘 짰다고 주장 | 난 숙제도 제대로 내주고 진도 따라서 스터디 플랜도 잘 짜줬다. |
| 4 | 학생이 숙제를 하지 않았다는 사실 언급 | 근데 님 애가 안 쳐한거임. |
| 5 | 학부모에게 학생이 숙제를 하도록 지도해줄 것을 권장 | 걍 다음에 잘 보고 싶으면 님도 애를 좀 잡아봐 숙제를 하게. |

**최종 변환 결과**

> 안녕하세요, 담임입니다.
>
> 아이의 성적이 좋지 않아 걱정하셨을 것 같습니다.
>
> 말씀드리기 조심스럽지만, 아이가 숙제를 제대로 하지 않은 점이 있어 이 부분에 대해 함께 고민해 보면 좋을 것 같아서 연락 드렸습니다.
>
> 저는 숙제를 잘 내주었고, 진도에 맞춘 스터디 플랜도 마련했습니다. 하지만 학생이 숙제를 하지 않았다면, 성적 향상이 어려울 수 있습니다.
>
> 다음 시험에서는 좋은 결과를 위해 학부모님께서도 아이에게 숙제를 잘 할 수 있도록 지도해 주시면 좋겠습니다.
>
> 감사합니다.

**Pipeline 통계**

| 항목 | 값 |
| --- | --- |
| 세그먼트 수 | 7 |
| GREEN / YELLOW / RED | 2 / 4 / 1 |
| Locked span 수 | 0 |
| Retry 횟수 | 0 |
| IdentityBooster | 미실행 |
| SituationAnalysis | 실행 |
| 선택 템플릿 | T08_FEEDBACK |
| 토큰 (분석) | prompt: 5,668 / completion: 482 |
| 토큰 (최종) | prompt: 4,353 / completion: 142 |
| 총 비용 | $0.00188 |
| 소요 시간 | 9,860ms |

**Validation 결과**

| Severity | Type | Description |
| --- | --- | --- |
| WARNING | ENDING_REPETITION | 동일 종결어미 3회 연속: "습니다" |
| WARNING | SECTION_S2_MISSING | S2(내부 확인/점검) 섹션 누락 |

판정: **WARN** (ERROR 없음, WARNING 2건)

**변환 결과 피드백**

1. **SECTION_S2 누락**: T08_FEEDBACK 템플릿의 S2(내부 확인/점검) 섹션 누락. "저는 숙제를 잘 내주었고..."가 S2 역할을 부분적으로 하지만, "확인 결과" / "점검해 본 바" 같은 S2 패턴 표현이 없어 검증기에서 누락 판정. "학생의 학습 상황을 확인해 본 결과, 숙제를 꾸준히 내주고..."처럼 확인/점검 프레임 필요.

2. **종결어미 반복**: "~습니다" 종결어미가 연속 5회 반복 ("같습니다", "드렸습니다", "마련했습니다", "있습니다", "좋겠습니다"). 기계적 느낌. "~것 같습니다", "~주시면 감사하겠습니다" 등 변주 필요.

3. **T4 라벨링**: "난 숙제도 제대로 내주고..." ACCOUNTABILITY보다 SELF_JUSTIFICATION이 더 적합하나, 둘 다 YELLOW이며 재작성 전략이 유사하여 실질 영향 미미.

4. **T6 라벨링**: "학원 바꿀꺼면 ㅃㅃ..." PERSONAL_ATTACK보다 AGGRESSION이 정확하나, 둘 다 RED로 완전 삭제되어 결과 영향 없음.

**종합 평가**

1. **핵심 판정**: 실사용 가능 (약간의 수정 권장)
2. **가장 잘 된 부분**: RED 삭제 완벽 ("학원 바꿀꺼면 ㅃㅃ" 흔적 없음). "님도 애를 좀 잡아봐" → "학부모님께서도 아이에게 숙제를 잘 할 수 있도록 지도해 주시면 좋겠습니다" 협력 요청 프레임 전환 효과적.
3. **가장 약한 부분**: 종결어미 "~습니다" 5회 반복으로 기계적 느낌. S2(내부 확인) 프레임 부재로 "저는 잘 했는데" 자기 변호 뉘앙스 잔존.
4. **수신자 인상**: 책임감 있는 설명과 협력 요청으로 느끼겠지만, "저는 잘 했는데 아이가 안 했다" 프레임이 약간 남아 방어적으로 읽힐 여지 있음.
5. **원문 의도 달성**: (1) 시험 결과 전달, (2) 교사 노력 강조, (3) 가정 학습 지도 요청 모두 전달됨. "내 탓 아님" 메시지가 적절히 희석되면서도 교사 노력이 사실로 전달되어 좋은 균형 유지.

---

### Scenario 2: 직장상사/사과, 항의

**라벨링 결과**

| ID  | Position | Tier   | Label              | 텍스트 (앞 30자)                              |
| --- | -------- | ------ | ------------------ | ------------------------------------------ |
| T1  | 0-30     | YELLOW | SELF_JUSTIFICATION | 솔직히 말해서 이번 일정 또 밀린거 저 때문만은 아니고  |
| T2  | 31-53    | YELLOW | ACCOUNTABILITY     | PR-482도 아직 안 닫혔고                   |
| T3  | 54-66    | YELLOW | ACCOUNTABILITY     | 김민수도 답을 안 줬고                             |
| T4  | 67-99    | YELLOW | ACCOUNTABILITY     | 그래서 v2.3.1 배포가 지금 이 꼴 난건데      |
| T5  | 100-132  | YELLOW | SELF_JUSTIFICATION | 아무튼 제가 다 책임져야 하는 분위기라 좀 억울하긴 합니다 |
| T6  | 133-187  | GREEN  | CORE_INTENT        | 근데 어쨌든 오늘 18:00 전에 report_final... |
| T7  | 188-205  | GREEN  | CORE_FACT          | 링크는 https://drive.company.com/alpha 이거고 |
| T8  | 206-227  | GREEN  | CORE_FACT          | 제 이메일은 alpha.team.lead@company.co.kr 인데 |
| T9  | 228-250  | YELLOW | SELF_JUSTIFICATION | 사실 어제도 새벽 3시까지 했고                   |
| T10 | 251-258  | RED    | PRIVATE_TMI        | 허리도 아프고                                    |
| T11 | 259-283  | RED    | PURE_GRUMBLE       | 이거 계속 이런식이면 저도 진짜 모르겠습니다            |
| T12 | 284-313  | GREEN  | CORE_INTENT        | 일단 오늘은 넘기고 나중에 구조 다시 갈아엎든지 하죠     |

**Situation Analysis**

- **Intent**: 일정 지연에 대한 억울함을 표현하고, 보고서를 제출할 것임을 알리려는 목적

| #  | Fact (content)                                                    | Source (source)                                                 |
| -- | ----------------------------------------------------------------- | --------------------------------------------------------------- |
| 1  | 이번 일정이 밀린 이유는 화자만의 책임이 아니다                            | 이번 일정 또 밀린거 저 때문만은 아니고                                 |
| 2  | PR-482가 아직 닫히지 않았고 김민수가 답을 주지 않았다                      | PR-482도 아직 안 닫혔고 김민수도 답을 안 줬고                    |
| 3  | v2.3.1 배포가 지연되고 있다                                           | 그래서 v2.3.1 배포가 지금 이 꼴 난건데                         |
| 4  | 화자는 오늘 18:00 전에 report_final_v3.docx를 올릴 예정이다              | 오늘 18:00 전에 report_final_v3.docx는 올리긴 올릴거고 |

**최종 변환 결과**

> 안녕하세요.
>
> 말씀해 주신 내용 확인했습니다. 이번 일정이 지연된 이유는 제가 전부 책임지기에는 억울한 부분이 있습니다. PR-482도 아직 닫히지 않았고, 김민수도 답을 주지 않아 v2.3.1 배포가 지연되고 있는 상황입니다.
>
> 어쨌든 오늘 18:00 전에 report_final_v3.docx는 꼭 올리겠습니다. 링크는 https://drive.company.com/alpha 이고, 제 이메일은 alpha.team.lead@company.co.kr 입니다. 사실 어제도 새벽 3시까지 작업을 진행했습니다.
>
> 일단 오늘은 절차를 마무리하고 이후에 필요 시 구조를 다시 개선하도록 하겠습니다. 감사합니다.
>
> [이름] 드림

**Pipeline 통계**

| 항목 | 값 |
| --- | --- |
| 세그먼트 수 | 12 |
| GREEN / YELLOW / RED | 4 / 6 / 2 |
| Locked span 수 | 6 (TICKET, VERSION, TIME x2, URL, EMAIL) |
| Retry 횟수 | 0 |
| IdentityBooster | 미실행 |
| SituationAnalysis | 실행 |
| 선택 템플릿 | T05_APOLOGY |
| 토큰 (분석) | prompt: 5,919 / completion: 596 |
| 토큰 (최종) | prompt: 4,955 / completion: 164 |
| 총 비용 | $0.00209 |
| 소요 시간 | 10,761ms |

**Validation 결과**

CLEAN (이슈 없음) — 판정: **PASS**

**변환 결과 피드백**

1. **YELLOW 재작성 미흡 — "억울한 부분이 있습니다" 직접 노출**: SELF_JUSTIFICATION 라벨임에도 "억울한"이라는 직접적 감정 표현이 거의 그대로 잔존. 상사에게 "억울하다"는 방어적/도전적으로 읽힘. → "일정 지연에 대해 복합적인 요인이 있었던 점을 말씀드리고 싶습니다" 등으로 전환 필요.

2. **T9 "새벽 3시까지" 라벨링 오류**: SELF_JUSTIFICATION으로 분류되었으나 PRIVATE_TMI(RED)에 해당. "새벽 3시까지 했고"는 사적 야근 정보로 즉시 RED 패턴. 결과적으로 "새벽 3시까지 작업을 진행했습니다"가 잔존하여 동정 유발 시도로 읽힘.

3. **T2/T3 비난 뉘앙스 잔존**: "PR-482도 아직 닫히지 않았고, 김민수도 답을 주지 않아"는 동료 실명 거론 + 책임 전가 뉘앙스. → "배포 지연에는 PR-482 미결 및 관련 담당자 회신 대기 등 복합적 요인이 있었습니다"로 전환 필요.

4. **"어쨌든" 잔존**: 구어체/투덜거리는 뉘앙스. 상사에게 부적절. 제거 필요.

5. **"말씀해 주신 내용 확인했습니다" 어색함**: 화자가 먼저 보내는 메시지인데 상사가 먼저 말한 것을 전제하는 표현. → "이번 일정 지연 건에 대해 말씀드립니다" 등으로 수정 필요.

6. **직접적 사과 표현 부재**: T05_APOLOGY 템플릿이 선택되었으나 "죄송합니다", "송구합니다" 등 명시적 사과가 없음.

**종합 평가**

1. **핵심 판정**: 수정 후 사용 가능 (usable with edits)
2. **가장 잘 된 부분**: RED(T10 "허리도 아프고", T11 "진짜 모르겠습니다") 완전 삭제. 고정 표현 7종 전량 보존. T12 "갈아엎든지 하죠" → "개선하도록 하겠습니다" 건설적 전환 효과적.
3. **가장 약한 부분**: YELLOW 재작성 전반적 미흡 — "억울한", "새벽 3시까지", 동료 실명 비난이 어미 정리 수준에 그침. 명시적 사과 표현 부재.
4. **수신자 인상**: 보고서 제출 약속은 명확하나, 감정 표현과 동료 탓 뉘앙스가 남아 "성숙하지 못하다"는 인상.
5. **원문 의도 달성**: (3) 보고서 제출 약속 완벽, (1) 사과는 직접적 표현 부재로 미달, (2) 원인 설명은 "변명"으로 읽힐 우려.

---

### Scenario 3: 고객/요청, 피드백

**라벨링 결과**

| ID | Position | Tier | Label | 텍스트 (첫 40자) |
|----|----------|------|-------|------------------|
| T1 | 0-51 | YELLOW | ACCOUNTABILITY | 고객님 솔직히 말씀드리면 이번 오류는 저희 쪽 문제라기보단 귀사 서... |
| T2 | 53-94 | YELLOW | ACCOUNTABILITY | 제가 지난번에도 config.yaml이랑 MainService.java 건... |
| T3 | 96-121 | YELLOW | NEGATIVE_FEEDBACK | 했는데 또 수정하셔서 이 사단이 난거 같습니다 |
| T4 | 122-222 | GREEN | CORE_INTENT | 아무튼 현재 010-4921-8823으로 연락주셔도 되고 계좌는... |
| T5 | 223-259 | RED | PRIVATE_TMI | 근데 저도 사람이라 하루종일 이런 대응하면 멘탈 좀 나... |

**Situation Analysis**

- **Intent**: 고객의 서버 설정 문제를 지적하고, 로그파일을 요청하여 문제를 해결하려는 목적

| # | 사실 (content) | 원문 출처 (source) |
|---|---------------|-------------------|
| 1 | 이번 오류는 고객사의 서버 설정 문제로 발생했다 | 이번 오류는 저희 쪽 문제라기보단 귀사 서버 설정이 이상해서 생긴거고 |
| 2 | config.yaml과 MainService.java를 수정하지 말라고 경고한 적이 있다 | 제가 지난번에도 config.yaml이랑 MainService.java 건드리지 말라고 했는데 |
| 3 | 고객이 수정한 설정으로 인해 문제가 발생한 것으로 보인다 | 또 수정하셔서 이 사단이 난거 같습니다 |
| 4 | 010-4921-8823으로 연락 가능, 계좌 110-123-456789 | 현재 010-4921-8823으로 연락주셔도 되고 계좌는 110-123-456789이다 |
| 5 | 환불 요청은 과한 것이라고 언급 | 환불 얘기는 좀 과한 것 같고 |

**최종 변환 결과**

> 고객님, 안녕하세요.
>
> 말씀 주신 내용 확인했습니다. 현재 발생한 오류는 우리 쪽 문제라기보다는 고객님 서버 설정에 문제가 있어 발생한 것으로 보입니다. 지난번에도 말씀드린 바와 같이, config.yaml과 MainService.java을 수정하지 말라고 경고드린 적이 있었는데, 다시 수정하신 것으로 인해 이와 같은 상황이 발생한 것 같습니다.
>
> 아무튼 현재 010-4921-8823으로 연락 주셔도 되고, 계좌는 110-123-456789입니다. 환불 요청은 다소 과한 것 같고 일단 로그파일 error_dump_2026_02_14.zip를 보내주시면 제가 확인해 보겠습니다.
>
> 감사합니다. [이름] 드림.

**Pipeline 통계**

| 항목 | 값 |
| --- | --- |
| 세그먼트 수 | 5 |
| GREEN / YELLOW / RED | 1 / 3 / 1 |
| Locked span 수 | 4 (FILE_PATH x2, PHONE, ACCOUNT) |
| Retry 횟수 | 0 |
| IdentityBooster | 미실행 |
| SituationAnalysis | 실행 |
| 선택 템플릿 | T11_REFUND_REJECTION |
| 토큰 (분석) | prompt: 5,733 / completion: 454 |
| 토큰 (최종) | prompt: 4,606 / completion: 159 |
| 총 비용 | $0.00192 |
| 소요 시간 | 7,407ms |

**Validation 결과**

CLEAN (이슈 없음) — 판정: **PASS**

**변환 결과 피드백**

1. **YELLOW 재작성 가장 큰 문제**: 원문의 공격적 표현이 충분히 완화되지 않음.
   - "우리 쪽 문제라기보다는 고객님 서버 설정에 문제가 있어" — 고객 직접 지목. → "확인 결과, 서버 설정 변경이 이번 오류의 원인으로 파악되었습니다" 처럼 주어를 행위로 전환 필요.
   - "경고드린 적이 있었는데, 다시 수정하신 것으로 인해" — 고객 직접 질책. → "config.yaml과 MainService.java는 수정 시 사전 협의가 필요한 파일입니다" 요청형 전환 필요.
   - "환불 요청은 다소 과한 것 같고" — 직접 거절. → "우선 오류 원인을 정확히 파악한 후 적절한 조치를 안내드리겠습니다" 간접 처리 필요.

2. **톤 부적절**: CLIENT 페르소나에 "우리 쪽"(→"저희 측"), "아무튼"(구어체) 잔존.

3. **수신자 관점**: "경고드린", "다시 수정하신 것으로 인해" 부분이 비난/질책으로 느껴져 고객 불쾌감 유발 가능. 쿠션 표현 부족.

**종합 평가**

1. **핵심 판정**: 수정 후 사용 가능 (usable with edits)
2. **가장 잘 된 부분**: 고정 표현 5종 완벽 보존. RED "멘탈 좀 나가긴 합니다" 흔적 없이 삭제.
3. **가장 약한 부분**: YELLOW 재작성이 거의 이루어지지 않음 — 비난/질책 뉘앙스가 표현만 약간 다듬어진 수준. "경고드린", "다시 수정하신 것으로 인해", "환불 요청은 다소 과한" 잔존.
4. **수신자 인상**: 정돈된 형태이나 "네가 잘못한 거다"가 직접적으로 전달되어 불쾌감 가능.
5. **원문 의도 달성**: 사실 전달과 로그파일 요청은 전달되었으나, "수신자가 방어적으로 느끼지 않게" 하는 YELLOW 전략 목표 미달성.

---

### Scenario 4: 교수/사과

**라벨링 결과**

| ID  | 위치      | Tier   | Label              | 텍스트 (앞 30자)                        |
| --- | --------- | ------ | ------------------ | --------------------------------------- |
| T1  | 0-31      | YELLOW | SELF_JUSTIFICATION | 교수님 이번 과제 제출이 늦어진건 사실 제 잘못도 있... |
| T2  | 32-58     | YELLOW | ACCOUNTABILITY     | JIRA-991 이 계속 꼬여서 그런거고    |
| T3  | 59-79     | RED    | PRIVATE_TMI        | 사실 개인적으로도 집안일이 좀 있었고      |
| T4  | 80-93     | RED    | PRIVATE_TMI        | 그래서 정신이 없었습니다                  |
| T5  | 94-140    | GREEN  | CORE_FACT          | 그래도 결과물은 final_thesis_v1.0.4.pdf... |
| T6  | 141-162   | GREEN  | CORE_INTENT        | https://snu-project-lab.com/upload 여기 업로드 예정 |
| T7  | 163-207   | YELLOW | NEGATIVE_FEEDBACK  | 솔직히 이런식으로 일정이 빡빡하면 연구 퀄리... |
| T8  | 208-227   | GREEN  | CORE_FACT          | UUID는 123e4567-e89b-12d3-a456-426614174000 이고 |
| T9  | 228-241   | GREEN  | APOLOGY            | 어쨌든 늦은건 죄송하지만                  |
| T10 | 242-260   | RED    | PURE_GRUMBLE       | 저만 탓받는 느낌은 좀 억울하네요          |

**Situation Analysis**

- **Intent**: 과제 제출 지연에 대한 사과와 함께, 연구 일정의 빡빡함이 연구 퀄리티에 미치는 영향을 전달하고자 하는 목적

| #  | Fact (content)                                                | Source (source)                                            |
| -- | ------------------------------------------------------------- | ---------------------------------------------------------- |
| 1  | 이번 과제 제출이 늦어진 것은 화자의 잘못도 있다              | 이번 과제 제출이 늦어진건 사실 제 잘못도 있지만            |
| 2  | 결과물은 final_thesis_v1.0.4.pdf로 정리되어 있다      | 그래도 결과물은 final_thesis_v1.0.4.pdf로 정리해놨고 |
| 3  | 과제는 https://snu-project-lab.com/upload에 업로드할 예정      | 여기 업로드 예정인데                                       |
| 4  | 연구 일정이 빡빡하면 연구 퀄리티가 떨어질 것이라 생각 | 솔직히 이런식으로 일정이 빡빡하면 연구 퀄리티가 떨어질 수밖에... |

**최종 변환 결과**

> 교수님, 이번 과제 제출이 늦어진 점 사과드립니다. 결과물은 final_thesis_v1.0.4.pdf로 정리되어 있으며, 해당 파일은 https://snu-project-lab.com/upload에 업로드할 예정입니다.
>
> 또한, JIRA-991 이슈가 계속 발생하여 일정에 어려움이 있었습니다. 이런 식으로 일정이 빡빡하면 연구 퀄리티가 떨어질 수밖에 없다고 생각합니다. UUID는 123e4567-e89b-12d3-a456-426614174000 입니다.
>
> 어쨌든 늦은 점에 대해 진심으로 사죄드리며, 앞으로 더욱 신경 쓰도록 하겠습니다.
>
> [이름] 올림.

**Pipeline 통계**

| 항목 | 값 |
| --- | --- |
| 세그먼트 수 | 10 |
| GREEN / YELLOW / RED | 4 / 3 / 3 |
| Locked span 수 | 4 (TICKET, VERSION, URL, UUID) |
| Retry 횟수 | 1 (SECTION_S2_MISSING WARNING) |
| IdentityBooster | 미실행 |
| SituationAnalysis | 실행 |
| 선택 템플릿 | T05_APOLOGY |
| 토큰 (분석) | prompt: 5,835 / completion: 572 |
| 토큰 (최종) | prompt: 4,682 / completion: 160 |
| 총 비용 | $0.002017 |
| 소요 시간 | 13,720ms |

**Validation 결과**

| 유형 | 심각도 | 메시지 |
|------|--------|--------|
| SECTION_S2_MISSING | WARNING | S2(내부 확인/점검) 섹션 누락 |

- Retry 1회 발생 (원인: SECTION_S2_MISSING WARNING). 재시도 후에도 미해결.
- 판정: **WARN** (ERROR 없음, WARNING 1건 잔존)

**변환 결과 피드백**

1. **T7 YELLOW 재작성 미변환 — 가장 심각한 문제**: "이런 식으로 일정이 빡빡하면 연구 퀄리티가 떨어질 수밖에 없다고 생각합니다"가 거의 원문 그대로 출력. 교수에게 불만/비판으로 읽힘. → "일정과 연구 품질의 균형에 대해 조언을 구하고 싶습니다" 등 요청/건의 형태로 전환 필요.

2. **S2 섹션 재시도 후에도 누락**: T05_APOLOGY 필수 섹션 S2 미생성. "확인해 본 결과" 같은 자기 점검 표현 필요.

3. **"어쨌든" 잔존**: 비격식적 표현. 교수에게 부적절.

4. **고정 표현 보존**: JIRA-991, final_thesis_v1.0.4.pdf, URL, UUID 모두 정확히 보존됨.

5. **RED 처리 완벽**: T3(집안일), T4(정신이 없었습니다), T10(억울하네요) 모두 완전 삭제.

**종합 평가**

1. **핵심 판정**: 수정 후 사용 가능 (usable with edits)
2. **가장 잘 된 부분**: RED(집안일, 정신 없었다, 억울함) 완전 삭제. 고정 표현 4종 정확 보존.
3. **가장 약한 부분**: T7 YELLOW "일정이 빡빡하면 퀄리티가 떨어질 수밖에 없다"가 원문 톤 그대로 잔존 — 교수에게 불만으로 읽힘. S2 섹션 재시도 후에도 누락.
4. **수신자(교수) 인상**: 사과의 진정성은 느껴지나, 일정 불만이 원문 톤으로 들어있어 "사과하면서 불평하는 학생" 인상.
5. **원문 의도 달성**: 사과 + 결과물 제출 안내는 충분히 전달. 일정-퀄리티 건의가 불만 형태로 남아 부정적 전달 위험.

---

## Overall Analysis

### 전체 품질 평가

**종합 판정**: 현재 파이프라인은 RED 삭제와 고정 표현 보존에서 매우 높은 품질을 보이며, 이 두 영역은 production-ready 수준이다. 그러나 **YELLOW 재작성 품질이 전반적으로 미흡**하여 4개 시나리오 모두 "수정 후 사용 가능" 판정을 받았다. YELLOW 세그먼트의 방어적/공격적 표현이 어미 정리 수준에 그치고, 내용 프레이밍 전환(비난→보고체, 방어→책임의지, 비판→건의/요청)이 충분히 이루어지지 않는 것이 가장 큰 구조적 문제이다. 시나리오1(학부모/피드백)이 가장 잘 처리된 유형이며, 시나리오3(고객/피드백)이 YELLOW 재작성 실패가 가장 심각하여 가장 취약한 유형이다. Gemini API 키 미설정으로 OpenAI fallback으로 실행되었으므로, 프로덕션 환경(gemini-2.5-flash)에서는 결과가 다를 수 있다.

**핵심 이슈 요약** (심각도순):

1. **[CRITICAL] YELLOW 재작성 실패 — 시나리오 3**: "경고드린 적이 있었는데, 다시 수정하신 것으로 인해" / "환불 요청은 다소 과한 것 같고" → 고객에게 직접 비난/거절이 거의 원문 그대로 전달됨. 수신자 불쾌감 유발. **원인**: Final prompt의 YELLOW 라벨별 재작성 전략(cushion→fact→direction)이 충분히 강제되지 않음.

2. **[CRITICAL] YELLOW 재작성 실패 — 시나리오 2**: "억울한 부분이 있습니다" 감정 직접 노출 + "김민수도 답을 주지 않아" 동료 실명 비난 잔존. 상사에게 방어적/미성숙 인상. **원인**: SELF_JUSTIFICATION/ACCOUNTABILITY 라벨의 재작성 강도가 약함.

3. **[HIGH] T7 YELLOW 원문 잔존 — 시나리오 4**: "일정이 빡빡하면 연구 퀄리티가 떨어질 수밖에 없다고 생각합니다" → NEGATIVE_FEEDBACK 라벨인데 재작성이 거의 미적용. 교수에게 불만으로 읽힘. **원인**: NEGATIVE_FEEDBACK 라벨의 재작성 전략 미준수.

4. **[HIGH] T9 라벨링 오류 — 시나리오 2**: "새벽 3시까지 했고"가 SELF_JUSTIFICATION(YELLOW)으로 분류되어야 할 것이 PRIVATE_TMI(RED)가 아닌 YELLOW로 분류됨. 결과적으로 사적 야근 정보 잔존. **원인**: StructureLabelService 프롬프트에서 "사적 생활 일정" 즉시 RED 패턴 매칭 실패.

5. **[MEDIUM] S2 섹션 누락 — 시나리오 1, 4**: T08_FEEDBACK, T05_APOLOGY 템플릿의 필수 섹션 S2(내부 확인/점검)가 생성되지 않음. 시나리오 4에서는 retry 후에도 미해결. **원인**: Final prompt에서 S2 섹션 지시가 충분히 구체적이지 않음.

6. **[MEDIUM] "어쨌든" 구어체 잔존 — 시나리오 2, 4**: 격식 있는 수신자(상사, 교수)에게 부적절한 구어체 접속사. **원인**: Final prompt에서 구어체 필터링 지시 부재 또는 미흡.

7. **[LOW] 종결어미 반복 — 시나리오 1**: "~습니다" 5회 연속 반복으로 기계적 느낌. **원인**: OutputValidator ENDING_REPETITION이 WARNING이지만 스트리밍 모드에서 retry 대상이 아님.

**반복 패턴**:

1. **YELLOW 재작성 미흡 패턴**: 시나리오 2, 3, 4 모두에서 YELLOW 세그먼트가 어미 정리 수준에 그치고 내용 프레이밍 전환이 이루어지지 않음. SELF_JUSTIFICATION, ACCOUNTABILITY, NEGATIVE_FEEDBACK 3개 라벨 모두에서 발생하므로, 특정 라벨이 아닌 YELLOW tier 전체의 재작성 강도가 부족한 구조적 문제.

2. **S2 섹션 누락 패턴**: 시나리오 1(T08_FEEDBACK), 4(T05_APOLOGY)에서 S2 누락. T05_APOLOGY에서는 retry 후에도 미해결. S2 섹션 지시가 LLM에 충분히 인식되지 않는 구조적 문제.

3. **구어체 잔존 패턴**: "어쨌든"(시나리오 2, 4), "아무튼"(시나리오 3)이 변환 결과에 그대로 잔존. 원문의 구어체 접속사가 필터링되지 않는 공통 문제.

**품질 개선 제안**:

#### 1. System prompt modification

**1-1. YELLOW 재작성 강화 — `app/pipeline/multi_model_pipeline.py` (또는 해당 Final prompt builder)**

현재 YELLOW 라벨별 재작성 전략이 충분히 강제되지 않음. Final prompt에 다음을 추가/강화:

```
YELLOW 세그먼트 재작성 규칙 (반드시 준수):
- SELF_JUSTIFICATION: 방어적 프레임("~때문만은 아니고", "억울하긴") 완전 제거. 감정 표현→책임의지 전환. "억울하다/서운하다" 같은 직접 감정어 금지.
- ACCOUNTABILITY: 특정 개인명 비난 금지. "김민수가 답을 안 줬고" → "관련 담당자 회신 대기" 식으로 개인→역할/상황 전환. "귀사 서버 설정이 이상해서" → "서버 설정 변경이 원인으로 파악됨" 식으로 주어를 행위로 전환.
- NEGATIVE_FEEDBACK: 불만/비판("빡빡하면 퀄리티가 떨어질 수밖에", "환불 얘기는 과한 것 같고") → 건의/요청 형태("조언을 구하고 싶습니다", "원인 파악 후 조치를 안내드리겠습니다")로 전환. 원문 톤을 그대로 유지하는 것은 재작성 실패.
```

**1-2. S2 섹션 생성 강화 — Final prompt builder**

S2 섹션 지시를 더 구체적으로:

```
S2(내부 확인/점검) 섹션: 반드시 "확인 결과", "점검한 바로는", "확인해 본 바" 중 하나의 표현을 포함하여 화자의 자체 확인 노력을 명시할 것. 이 표현이 없으면 S2 누락으로 판정됨.
```

**1-3. 구어체 필터링 — Final prompt builder**

```
구어체 접속사 금지: "어쨌든", "아무튼", "걍", "근데" 등 구어체 접속사는 변환 결과에 포함하지 말 것. 각각 "이에", "현재", 삭제, "그러나"로 대체하거나 제거할 것.
```

**1-4. 사과 표현 명시 — Final prompt builder (T05_APOLOGY 템플릿)**

```
T05_APOLOGY 사용 시: 반드시 첫 문단 또는 두 번째 문단에 명시적 사과 표현("죄송합니다", "송구합니다", "사과드립니다") 포함할 것.
```

#### 2. Server pre/post-processing reinforcement

**2-1. 라벨링 패턴 강화 — `app/pipeline/labeling/structure_label_service.py`**

T9 "새벽 3시까지 했고" 라벨링 오류 해결. StructureLabelService 프롬프트에 PRIVATE_TMI 즉시 RED 패턴 예시 추가:

```
PRIVATE_TMI 즉시 RED 패턴 (추가 예시):
- "새벽 N시까지 했고/작업했고" → RED(PRIVATE_TMI)
- "밤새 작업/야근" → RED(PRIVATE_TMI)
- "허리가/몸이 아프고" → RED(PRIVATE_TMI)
```

**2-2. OutputValidator 구어체 검증 규칙 추가 — `app/pipeline/` (OutputValidator)**

새 검증 규칙 INFORMAL_CONJUNCTION 추가: "어쨌든", "아무튼", "걍", "근데" 등이 출력에 포함되면 WARNING 발생.

#### 3. Pipeline structure change

현시점에서 구조 변경까지 필요한 이슈는 없음. 위 1, 2단계 개선으로 YELLOW 재작성과 S2 생성 문제가 해결되지 않을 경우, YELLOW 세그먼트 전용 중간 LLM 단계 도입을 검토할 수 있으나, 먼저 프롬프트 강화로 효과를 확인하는 것이 우선.

### 검증 이슈 분석

**반복 이슈 패턴**:

1. **SECTION_S2_MISSING**: 시나리오 1(WARNING), 시나리오 4(WARNING, retry 후 미해결). T08_FEEDBACK과 T05_APOLOGY 템플릿 모두에서 S2 섹션 생성 실패. LLM이 S2 패턴 표현("확인 결과", "점검한 바로는")을 자발적으로 생성하지 않는 경향.

2. **ENDING_REPETITION**: 시나리오 1에서 "~습니다" 5회 반복 WARNING 발생. 다른 시나리오에서는 미발생이나, 짧은 출력(시나리오1: 142 토큰)에서 종결어미 다양성이 부족한 경향.

**검증 이슈 감소를 위한 개선 제안**:

1. **System prompt modification**:
   - S2 섹션: Final prompt에 S2 필수 표현 목록("확인 결과/점검한 바로는/확인해 본 바")을 명시하고, 해당 표현 중 최소 1개를 반드시 포함하도록 지시 강화. 대상 파일: Final prompt builder.
   - ENDING_REPETITION: Final prompt에 "동일 종결어미 3회 연속 사용 금지. '~습니다', '~입니다', '~겠습니다' 등을 교차 사용할 것" 지시 추가.

2. **Server pre/post-processing reinforcement**:
   - SECTION_S2_MISSING이 retry 후에도 미해결되는 경우(시나리오4), retry 시 S2 관련 힌트를 추가 주입하는 로직 검토. 대상 파일: OutputValidator / retry logic.

3. **Pipeline structure change**: 현시점 불필요.

## Changes vs Previous Log

First run — no comparison available
